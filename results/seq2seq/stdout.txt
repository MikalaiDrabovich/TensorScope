sudo ./run_seq2seq_training.sh
[sudo] password for ndr: 
/usr/local/lib/python3.5/dist-packages/h5py/__init__.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  from ._conv import register_converters as _register_converters
# Job id 0
# Set random seed to 1
# Loading hparams from /home/ndr/work/tf/data/seq2seq/nmt_model/hparams
  saving hparams to /home/ndr/work/tf/data/seq2seq/nmt_model/hparams
  saving hparams to /home/ndr/work/tf/data/seq2seq/nmt_model/best_bleu/hparams
  attention=
  attention_architecture=standard
  avg_ckpts=False
  batch_size=128
  beam_width=0
  best_bleu=0
  best_bleu_dir=/home/ndr/work/tf/data/seq2seq/nmt_model/best_bleu
  check_special_token=True
  colocate_gradients_with_ops=True
  decay_scheme=
  dev_prefix=/home/ndr/work/tf/data/seq2seq/nmt_data/tst2012
  dropout=0.2
  embed_prefix=None
  encoder_type=uni
  eos=</s>
  epoch_step=0
  forget_bias=1.0
  infer_batch_size=32
  init_op=uniform
  init_weight=0.1
  learning_rate=1.0
  length_penalty_weight=0.0
  log_device_placement=False
  max_gradient_norm=5.0
  max_train=0
  metrics=['bleu']
  num_buckets=5
  num_decoder_layers=3
  num_decoder_residual_layers=0
  num_embeddings_partitions=0
  num_encoder_layers=3
  num_encoder_residual_layers=0
  num_gpus=1
  num_inter_threads=2
  num_intra_threads=2
  num_keep_ckpts=5
  num_layers=3
  num_train_steps=24000
  num_translations_per_input=1
  num_units=128
  optimizer=sgd
  out_dir=/home/ndr/work/tf/data/seq2seq/nmt_model
  output_attention=True
  override_loaded_hparams=False
  pass_hidden_state=True
  random_seed=1
  residual=False
  sampling_temperature=0.0
  share_vocab=False
  sos=<s>
  src=vi
  src_embed_file=
  src_max_len=50
  src_max_len_infer=None
  src_vocab_file=/home/ndr/work/tf/data/seq2seq/nmt_data/vocab.vi
  src_vocab_size=7709
  steps_per_external_eval=None
  steps_per_stats=100
  subword_option=
  test_prefix=/home/ndr/work/tf/data/seq2seq/nmt_data/tst2013
  tgt=en
  tgt_embed_file=
  tgt_max_len=50
  tgt_max_len_infer=None
  tgt_vocab_file=/home/ndr/work/tf/data/seq2seq/nmt_data/vocab.en
  tgt_vocab_size=17191
  time_major=True
  train_prefix=/home/ndr/work/tf/data/seq2seq/nmt_data/train
  unit_type=lstm
  vocab_prefix=/home/ndr/work/tf/data/seq2seq/nmt_data/vocab
  warmup_scheme=t2t
  warmup_steps=0
# creating train graph ...
  num_layers = 3, num_residual_layers=0
  cell 0  LSTM, forget_bias=1  DropoutWrapper, dropout=0.2   DeviceWrapper, device=/gpu:0
  cell 1  LSTM, forget_bias=1  DropoutWrapper, dropout=0.2   DeviceWrapper, device=/gpu:0
  cell 2  LSTM, forget_bias=1  DropoutWrapper, dropout=0.2   DeviceWrapper, device=/gpu:0
  cell 0  LSTM, forget_bias=1  DropoutWrapper, dropout=0.2   DeviceWrapper, device=/gpu:0
  cell 1  LSTM, forget_bias=1  DropoutWrapper, dropout=0.2   DeviceWrapper, device=/gpu:0
  cell 2  LSTM, forget_bias=1  DropoutWrapper, dropout=0.2   DeviceWrapper, device=/gpu:0
  learning_rate=1, warmup_steps=0, warmup_scheme=t2t
  decay_scheme=, start_decay_step=24000, decay_steps 0, decay_factor 1
# Trainable variables
  embeddings/encoder/embedding_encoder:0, (7709, 128), /device:GPU:0
  embeddings/decoder/embedding_decoder:0, (17191, 128), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_0/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_0/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_1/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_1/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_2/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_2/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_0/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_0/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_1/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_1/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_2/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_2/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/output_projection/kernel:0, (128, 17191), 
# creating eval graph ...
  num_layers = 3, num_residual_layers=0
  cell 0  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 1  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 2  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 0  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 1  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 2  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
# Trainable variables
  embeddings/encoder/embedding_encoder:0, (7709, 128), /device:GPU:0
  embeddings/decoder/embedding_decoder:0, (17191, 128), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_0/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_0/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_1/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_1/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_2/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_2/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_0/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_0/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_1/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_1/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_2/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_2/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/output_projection/kernel:0, (128, 17191), 
# creating infer graph ...
  num_layers = 3, num_residual_layers=0
  cell 0  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 1  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 2  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 0  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 1  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
  cell 2  LSTM, forget_bias=1  DeviceWrapper, device=/gpu:0
# Trainable variables
  embeddings/encoder/embedding_encoder:0, (7709, 128), /device:GPU:0
  embeddings/decoder/embedding_decoder:0, (17191, 128), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_0/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_0/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_1/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_1/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_2/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/encoder/rnn/multi_rnn_cell/cell_2/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_0/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_0/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_1/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_1/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_2/basic_lstm_cell/kernel:0, (256, 512), /device:GPU:0
  dynamic_seq2seq/decoder/multi_rnn_cell/cell_2/basic_lstm_cell/bias:0, (512,), /device:GPU:0
  dynamic_seq2seq/decoder/output_projection/kernel:0, (128, 17191), 
# log_file=/home/ndr/work/tf/data/seq2seq/nmt_model/log_1528828929
2018-06-12 11:42:09.346387: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2018-06-12 11:42:09.346815: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1356] Found device 0 with properties: 
name: GeForce GTX 1060 major: 6 minor: 1 memoryClockRate(GHz): 1.6705
pciBusID: 0000:01:00.0
totalMemory: 5.94GiB freeMemory: 4.79GiB
2018-06-12 11:42:09.346848: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1435] Adding visible gpu devices: 0
2018-06-12 11:42:09.526524: I tensorflow/core/common_runtime/gpu/gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:
2018-06-12 11:42:09.526549: I tensorflow/core/common_runtime/gpu/gpu_device.cc:929]      0 
2018-06-12 11:42:09.526573: I tensorflow/core/common_runtime/gpu/gpu_device.cc:942] 0:   N 
2018-06-12 11:42:09.526744: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4553 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060, pci bus id: 0000:01:00.0, compute capability: 6.1)
2018-06-12 11:42:09.527511: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1435] Adding visible gpu devices: 0
2018-06-12 11:42:09.527547: I tensorflow/core/common_runtime/gpu/gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:
2018-06-12 11:42:09.527571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:929]      0 
2018-06-12 11:42:09.527575: I tensorflow/core/common_runtime/gpu/gpu_device.cc:942] 0:   N 
2018-06-12 11:42:09.527667: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4553 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060, pci bus id: 0000:01:00.0, compute capability: 6.1)
2018-06-12 11:42:09.528004: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1435] Adding visible gpu devices: 0
2018-06-12 11:42:09.528038: I tensorflow/core/common_runtime/gpu/gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:
2018-06-12 11:42:09.528044: I tensorflow/core/common_runtime/gpu/gpu_device.cc:929]      0 
2018-06-12 11:42:09.528066: I tensorflow/core/common_runtime/gpu/gpu_device.cc:942] 0:   N 
2018-06-12 11:42:09.528149: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 4553 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060, pci bus id: 0000:01:00.0, compute capability: 6.1)
  created train model with fresh parameters, time 0.21s
  created infer model with fresh parameters, time 0.07s
  # 275
    src: yêu công nghệ , thích sáng tạo
    ref: We love technology . We love creativity .
    nmt: weeds weeds weeds sharing sharing Rockefeller Rockefeller Crick Crick scaled scaled shaped shaped juice
  created eval model with fresh parameters, time 0.09s
  eval dev: perplexity 17189.86, time 0s, Tue Jun 12 11:42:11 2018.
  eval test: perplexity 17188.03, time 0s, Tue Jun 12 11:42:11 2018.
2018-06-12 11:42:11.960383: I tensorflow/core/kernels/lookup_util.cc:372] Table trying to initialize from file /home/ndr/work/tf/data/seq2seq/nmt_data/vocab.vi is already initialized.
2018-06-12 11:42:11.960395: I tensorflow/core/kernels/lookup_util.cc:372] Table trying to initialize from file /home/ndr/work/tf/data/seq2seq/nmt_data/vocab.en is already initialized.
2018-06-12 11:42:11.960562: I tensorflow/core/kernels/lookup_util.cc:372] Table trying to initialize from file /home/ndr/work/tf/data/seq2seq/nmt_data/vocab.en is already initialized.
  created infer model with fresh parameters, time 0.05s
# Start step 0, lr 1, Tue Jun 12 11:42:11 2018
# Init train iterator, skipping 0 elements
305 ops no flops stats due to incomplete shapes.
Parsing Inputs...
2018-06-12 11:42:13.599314: I tensorflow/stream_executor/dso_loader.cc:152] successfully opened CUDA library libcupti.so.9.1 locally
Step 0/10(14) completed in 4.8083 seconds.
New device info extracted from metadata: /device:GPU:0/stream:15 GPU 0
New device info extracted from metadata: /device:GPU:0/stream:14 GPU 0
New device info extracted from metadata: /job:localhost/replica:0/task:0/device:CPU:0 CPU 0
New device info extracted from metadata: /device:GPU:0/memcpy GPU 0
New device info extracted from metadata: /device:GPU:0/stream:all GPU 0
New device info extracted from metadata: /job:localhost/replica:0/task:0/device:GPU:0 GPU 0
New device info extracted from metadata: /device:GPU:0/stream:13 GPU 0
Session graph and metadata parsed in 10.5510 seconds
Step 1/10(14) completed in 0.7020 seconds.
Timeline saved in /tmp/tensorscope/timeline_at_step_2_1528828952.json
Step 2/10(14) completed in 0.5421 seconds.
Step 3/10(14) completed in 0.7354 seconds.
Step 4/10(14) completed in 0.4649 seconds.
Step 5/10(14) completed in 0.5672 seconds.
Step 6/10(14) completed in 0.2636 seconds.
Step 7/10(14) completed in 0.3593 seconds.
Step 8/10(14) completed in 0.9700 seconds.
Step 9/10(14) completed in 0.9416 seconds.
Step 10/10(14) completed in 0.6238 seconds.
Session is closed

Sanity check: total time for 10 steps: 6.170 sec., 1 step avg. time:  616993.6 microsec., 1 step avg. time captured in metadata: 265001.8 microsec., number of unique ops: 2244
This node was not found in self.final_io_shapes, however it existed in metadata graph:  dynamic_seq2seq/decoder/decoder/TensorArrayStack/TensorArrayGatherV3:MEMCPYHtoD
This node was not found in self.final_io_shapes, however it existed in metadata graph:  gradients/dynamic_seq2seq/encoder/rnn/TensorArrayUnstack/TensorArrayScatter/TensorArrayScatterV3_grad/TensorArrayGatherV3:MEMCPYDtoD
This node was not found in self.final_io_shapes, however it existed in metadata graph:  dynamic_seq2seq/decoder/decoder/TensorArrayStack/TensorArrayGatherV3:MEMCPYDtoD
This node was not found in self.final_io_shapes, however it existed in metadata graph:  gradients/dynamic_seq2seq/encoder/rnn/TensorArrayUnstack/TensorArrayScatter/TensorArrayScatterV3_grad/TensorArrayGatherV3:MEMCPYHtoD

2 - Total time for 10 steps: 6.170 sec., 1 step avg. time:  616993.6 microsec., 1 step avg. time captured in metadata: 265001.8 microsec., number of unique ops: 413

*** Brief summary of findings ***

Top-1 ops (0.2%)	27.1 ms (10.2%)
Top-2 ops (0.5%)	44.3 ms (16.7%)
Top-4 ops (1.0%)	63.9 ms (24.1%)
Top-7 ops (1.7%)	86.7 ms (32.7%)
Top-15 ops (3.6%)	137.4 ms (51.9%)
Top-28 ops (6.8%)	191.2 ms (72.1%)
Top-55 ops (13.3%)	240.2 ms (90.7%)
Top-108 ops (26.2%)	256.5 ms (96.8%)
Top-211 ops (51.1%)	263.8 ms (99.5%)
Top-413 ops (100.0%)	265.0 ms (100.0%)

*** I/O tensor shapes for kernel optimizations (for this specific mo5 del and batch size) are saved to /tmp/tensorscope/data_1528828960.tsv ***

Writing /tmp/tensorscope/chart_1528828960.html...

*** Interactive pie chart with details is saved to /tmp/tensorscope/chart_1528828960.html

Launching the browser to show generated chart: google-chrome --no-sandbox "/tmp/tensorscope/chart_1528828960.html"

